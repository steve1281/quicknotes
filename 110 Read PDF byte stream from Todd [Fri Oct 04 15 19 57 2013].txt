    Private Sub OpenPDF_sproc(ByVal agreementID As Integer, ByVal contractType As String)
        '' this method retrieves pdf data from a sproc.


        Dim sqlargs As IDictionary(Of String, Object) = New Dictionary(Of String, Object)
        sqlargs.Add("AgreementID", agreementID)
        Dim dt As DataTable
        Try
            dt = TBayTel.SqlUtil.execStoredProcDataTable("tbt.serviceAgreementDocuments_Get", sqlargs, "TbaytelSqlServer")
        Catch ex As Exception
            BuildErrorResponse(NODATA)
            Return
        End Try

        '' check to see if there is any rows of data returned.
        If dt.Rows.Count <= 0 Then
            BuildErrorResponse(NODATA)
            Return
        End If


        Dim responseData As [Byte]()


        Select Case contractType
            Case CISPDF
                responseData = dt.Rows(0).Item(CISPDF)
            Case CONTRACTPDF
                responseData = dt.Rows(0).Item(CONTRACTPDF)
            Case CISCURRENTPDF
                '' @todo. 
                responseData = dt.Rows(0).Item(CISPDF)
            Case Else
                BuildErrorResponse(BADPARAMS)
                Return
        End Select

        '' build te response.

        Response.ContentType = "application/pdf"
        Response.Clear()
        Response.ClearContent()
        Response.ClearHeaders()
        Response.ContentType = "application/pdf"
        Response.AddHeader("Content-Length", responseData.Length.ToString)
        Response.AddHeader("Content-Disposition", "attachment; filename=" & contractType & ".pdf")
        Response.OutputStream.Write(responseData, 0, CInt(responseData.Length))
        Response.Flush()
        Response.Close()

    End Subs 