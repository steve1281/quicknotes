Todd Burton
3:35 PM (0 minutes ago)

to me 
This query needs some work, but you might find it useful.

Note: Will return any contract between those set of dates, not just the most recent contract.
Note 2: Returns CDMA, HSPA, Wireline, etc.

select * from contract c
inner join subscription_point sp on c.sbr_subscription_id = sp.sbr_subscription_id
inner join subscriber_status ss on ss.SBS_SUBSCRIBER_STATUS_ID = getcurrentsubstatus(sp.SBR_SUBSCRIPTION_ID)
inner join status_option so on so.sop_status_id = ss.sbs_status
where ctr_stop_date between to_date('01-NOV-12') and to_date('10-NOV-12')
and so.sop_description not like 'Cancelled'
and c.sbr_subscription_id in (
      select c2.sbr_subscription_id from contract c2
      inner join subscription_point sp2 on c2.sbr_subscription_id = sp2.sbr_subscription_id
      inner join subscriber_status ss2 on ss2.SBS_SUBSCRIBER_STATUS_ID = getcurrentsubstatus(sp2.SBR_SUBSCRIPTION_ID)
      inner join status_option so2 on so2.sop_status_id = ss2.sbs_status
      where c2.ctr_start_date between to_date('11-NOV-12') and to_date('30-NOV-12')
      and so2.sop_description not like 'Cancelled'
)
and rownum < 100

Falcigno's revision:


select * from contract c
inner join subscription_point sp on c.sbr_subscription_id = sp.sbr_subscription_id
inner join subscriber_status ss on ss.SBS_SUBSCRIBER_STATUS_ID = getcurrentsubstatus(sp.SBR_SUBSCRIPTION_ID)
inner join status_option so on so.sop_status_id = ss.sbs_status
where ctr_stop_date between to_date('01-NOV-13') and to_date('02-DEC-13')
and so.sop_description not like 'Cancelled'
and c.sbr_subscription_id not in (
      select c2.sbr_subscription_id from contract c2
      inner join subscription_point sp2 on c2.sbr_subscription_id = sp2.sbr_subscription_id
      inner join subscriber_status ss2 on ss2.SBS_SUBSCRIBER_STATUS_ID = getcurrentsubstatus(sp2.SBR_SUBSCRIPTION_ID)
      inner join status_option so2 on so2.sop_status_id = ss2.sbs_status
      where c2.ctr_stop_date > to_date('02-DEC-13')
      and so2.sop_description not like 'Cancelled'
)
and rownum < 100


